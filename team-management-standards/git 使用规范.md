# 软通 重庆气象局项目 - git 提交规范

## 0. 特别注意事项

#### 1. 如果你不熟悉 Git，请不要使用任何和 `git rebase` 相关的命令!

#### 2. 执行 `git push` 以前请考虑清楚，一旦 `push`，会影响到所有人的代码库!

#### 3. 禁止用 中文 命名 `branch` 和 `tag`!

## 1. `commit` 内容格式规范

为了形成工作闭环，反应工作量和开发卡点，git 的提交内容应保持和 ["开发工作计划表"](https://docs.qq.com/sheet/DZG1waGJvbmZ2bEda?tab=k0ncm5) 一致，<b style="color: red;">**特别是: 每次提交需要包含 [开发工作计划表](https://docs.qq.com/sheet/DZG1waGJvbmZ2bEda?tab=k0ncm5) 需求项对应的编号列中的编号**</b>。

具体编写 commit 内容时，以"行"为单位，每行都按如下标准格式编写:

**`[类别](上下文):_概要说明_`**

其中，"类别" 和 "上下文" 不能乱写，需要按如下规范填入:

| 类别      | 上下文                                                                                               | 含义                                                                      |
| --------- | ---------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------- |
| feature   | 在线文档 ["开发工作计划表"](https://docs.qq.com/sheet/DZG1waGJvbmZ2bEda?tab=k0ncm5) 需求项的**编号** | 实现某个需求                                                              |
| update    | 在线文档 ["开发工作计划表"](https://docs.qq.com/sheet/DZG1waGJvbmZ2bEda?tab=k0ncm5) 需求项的**编号** | 因为需求变更，导致需要修改对应的代码                                      |
| bugfix    | 禅道 bug 编号                                                                                        | 修复 bug                                                                  |
| optimize  | 无                                                                                                   | 优化了某些资源的使用，比如优化了内存占用                                  |
| util      | 无                                                                                                   | 本次提交的是业务无关的功能性代码，比如 `StringUtils` / `RedisHelper` 之类 |
| refactory | 无                                                                                                   | 重构了代码                                                                |

"概要说明"：简短描述一下此次提交的关键技术信息，原则是 "**看到这个描述，就知道大概在技术上做了什么事情**"

### `commit` 应尽量说明 <b style="background-color:yellow">"为什么要这样做"</b>，而不仅仅是 "做了什么"，说不清楚可以多写几个字

下面列出了良好 `commit` 和不好 `commit` 的例子，请各位参考：

| 场景     | 良好的注释                                                     | 一般的注释                 | 很烂的注释     |
| -------- | :------------------------------------------------------------- | -------------------------- | -------------- |
| 实现需求 | `[feature](#123) 因为 xxx 需求频繁改变，添加 yyy 接口隔离变化` | 添加了 yyy 接口            | 整理了一些代码 |
| 重构     | `[refactory] 增加复用度，把 读写 FTP 文件 功能抽到 XXX 类`     | 添加 FTP 读写类 XXX        | 重构了代码     |
| Bug 修复 | `[bugfix](#56) 修复了因为线程时序问题导致 读取配置失败 的 bug` | 修复了 读取配置失败 的 bug | 修复 bug       |

### 规范示例

#### 如果你实现了一个 需求(注意下面 #178 为举例，实际上应该是 ["开发工作计划表"](https://docs.qq.com/sheet/DZG1waGJvbmZ2bEda?tab=k0ncm5) 上可以查询到的编号)

```txt
[feature](#178): 初步实现，其中因为没有 xxx 数据源，yyy 类使用模拟数据代替
```

#### 如果一个 需求 太大，需要改动很多地方，可以多次提交(下面展示了 需求 #51 拆分成了 3 个 commit)

```txt
[feature](#51): 从 xxx 系统拉取数据并保存到本地
```

```txt
[feature](#51): 根据 yyy 字段实现了 zzz 算法
```

```txt
[feature](#51): 调用 xxx 系统接口上传数据
```

#### 如果某个需求修改了，导致你要修改这个需求对应的实现

```txt
[update](#178): 根据 YY-MM-dd日 的宣讲，修改代码实现为: xxxyyyzzz
```

#### 如果你修复了 bug(bug 号为 禅道上的 bug 编号)

```txt
[bug](#17): 初步修复，可能复现
[bug](#25): 完全修复，因为同时修改了基础模块，所以可能引入新 bug
```

#### 如果你优化了性能

```txt
[optimize]: 优化了 xxx 业务的 redis 内存使用率，预估相同数据的内存占用率减少了 30%
```

## 2. `commit` 提交规范

### 2.1 一个 `commit` <b style="background-color:yellow">只做一件事</b>

如果你 "又添加了功能，又重构了代码"，最好分 2 个 `commit` 提交。

### 2.2 一个 `commit` 在逻辑上是一个<b style="background-color:yellow">整体</b>

比如你添加了一个功能，涉及到 5 个类的修改，则本次 `commit` 需要包含所有这 5 个类的相关改动，不能遗漏。

### 2.3 每次 `commit` 以后必须保证程序<b style="background-color:yellow">可运行</b>(可以存在 bug)

即：另外一个人把这个 `commit` 拉到本地以后，不会出现 **编译不过** 或者 **运行就 crash** 的状况。

### 2.4 每个 `commit` 涉及的文件数量不超过 10 个

即：使用 “小步快跑” 式提交，把握好粒度，**不要修改了很多代码后，才想到提交一次**。

<p></p>

## 3. `branch` 使用规范

### 3.1 _master/main_ 分支上的代码，就是生产环境的代码

_master/main_ 上只应该存在正式交付的代码，即只有打了 release `tag`(见下面) 后，才能把代码并入此分支。

### 3.2 分支命名规范 (粗体字为固定格式，斜体字为自己修改的地方)

| 使用场景                   | 命名规则                     | 说明                                                                                                              | 示例                                  |
| -------------------------- | ---------------------------- | ----------------------------------------------------------------------------------------------------------------- | ------------------------------------- |
| 开发一个需求               | **feature-**_xxxx_           | xxxx 为 feature 编号(["开发工作计划表"](https://docs.qq.com/sheet/DZG1waGJvbmZ2bEda?tab=k0ncm5) 需求项的**编号**) | feature-35                            |
| 修改一个 bug               | **bugfix-**_xxxx_            | xxxx 为 禅道 bug id                                                                                               | bugfix-24                             |
| 紧急修改一个 bug           | **hotfix-**_yyyy-MM-dd-xxxx_ | 用于来不及上禅道的紧急 bug 修改，yyyy-MM-dd 为修复当天日期，xxxx 为 bug 的简短英文描述                            | hotfix-2023-12-23-redis-oom           |
| 验证一个技术实现思路       | **try-**_xxxx_               | 如果发现思路不行，整个分支的代码都可以不要，xxxx 为自己的归纳描述(英文)                                           | try-parse-json-using-multi-thread     |
| 专门为了测试某个场景       | **test-**_xxxx_              | 用于复现某个问题，或测试某个复杂的功能，xxxx 为自己的归纳描述(英文)                                               | test-redis-save-memory                |
| 临时为了某个场景新建的分支 | **tmp-**_yyyy-MM-dd-xxxx_    | 用于临时救急使用，比如客户突然说要看一个版本之类，yyyy-MM-dd 为修复当天日期，xxxx 为自己的归纳描述(英文)          | tmp-2023-12-15-demo-publish-to-client |

<p></p>

## 4. `tag` 使用规范 (粗体字为固定格式，斜体字为自己修改的地方)

| 使用场景                                         | 命名规则                    | 说明                    | 示例                 |
| ------------------------------------------------ | --------------------------- | ----------------------- | -------------------- |
| 标记某个 commit 的代码，给测试团队测试           | **test-**_yyyy-MM-dd_       | yy-MM-dd 为发布当天日期 | test-2023-12-12      |
| 标记某个 commit 的代码，给客户演示(上到生产环境) | **milestone-v**_yyyy-MM-dd_ | yy-MM-dd 为发布当天日期 | milestone-2023-12-12 |
| 标记某个 commit 的代码，作为正式交付的版本       | **release-v**_yyyy-MM-dd_   | yy-MM-dd 为发布当天日期 | release-2023-12-12   |
